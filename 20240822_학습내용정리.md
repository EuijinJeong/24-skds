# Oracle SQL: Sub Query Join, INNER JOIN, Recursive Join 및 계층 쿼리

***

## 1. Sub Query Join이란?
> 서브쿼리를 사용하여 다른 쿼리와 조인하는 방식이다. 서브쿼리는 주 쿼리의 `SELECT`, `WHERE`, `FROM` 절에서 사용될 수 있다. 서브쿼리를 통해 더 복잡한 데이터 관계를 처리하거나, 필터링 조건을 정의할 수 있다.
> 주로 WHERE에서 사용되긴 한다.

쿼리문을 작성하는 형식은 아래와 같다.

<img width="368" alt="image" src="https://github.com/user-attachments/assets/2b96e252-137a-4f36-931d-13010a5b1f66">

## JOIN이란?
> 테이블간에 pk와 fk를 통해서 관련 정보드를 가져오는 행위를 말한다.

## 2. INNER JOIN (가장 기본 조인)
> INNER JOIN은 테이블 A와 테이블 B에서 공통된 정보를 가져오는 것을 말한다 (집합 ㄱ와 집합 ㄴ의 교집합을 찾는 행위라고 생각하면 이해하기 편하다.)

쿼리 작성 형식은 아래와 같다.

<img width="220" alt="image" src="https://github.com/user-attachments/assets/6f139052-7327-4280-b3e0-3788a6ce78f6">

### join문을 작성할 때 테이블이 다르고 SELECT하는 컬럼이 달라도 항상 닉네임을 할당해서 가시적으로 표시하는게 쿼리문의 가독성에 도움이 많이 된다.

## 3. Recursive Join이란?
> 자기 참조(self-referencing) 쿼리이다. 계층적 데이터를 조회할 때 사용되며, 부모-자식 관계를 정의할 수 있다.
> 자기 참조를 할 때 데이터베이스에서 동작하는 작동 원리가 달라지는데 부모컬럼과 자식 컬럼 행을 하나하나 비교하여 조건에 충족하는 값만 가져온다.
> 데이터의 값이 작다면 상관이 없겠지만 만약 데이터베이스가 가지고 있는 데이터 자체의 양이 방대하다면 성능이 많이 하락할 수 있어서 이를 염두하면서 쿼리문을 작성해야한다.

사용 예시는 아래와 같다.

<img width="396" alt="스크린샷 2024-08-22 오후 10 35 46" src="https://github.com/user-attachments/assets/b3a5ae4f-7178-4d42-9d8e-ecf35bbefb26">

## 4. 계층 쿼리
> 어떤 계층형 구조 (예시로 쿠팡의 하위 카테고리와 상위 카테고리) 이런 구조에서 정보를 조회할 때 효율적인 정보 탐색을 위해 사용된다.
> 이는 정식 sql 문법이 아니며 각 데이터베이스 시스템마다 조회하는 문법이 상이하다. (오라클에서는 CONNECT BY절을 사용한다.)

쿼리 작성 형식은 아래와 같다.

<img width="304" alt="image" src="https://github.com/user-attachments/assets/a535c88a-25d3-4767-9ae0-c510a682eac2">

여기서 SELECT LEVEL을 통하여 각 계층에 레벨을 부여하여 가시적으로 보기 쉽게 데이터를 불러올 수 있다.

CONNECT BY PRIOR는 일반 SQL문의 WHERE 즉 조건이라고 생각하면 될 것 같다.
좌변에는 내가 알고 싶은 대상의 컬럼명을 입력하고 우변에는 데이터 조회 기준 (즉 START WITH에 해당하는 컬럼)을 작성하면 된다.

## 계층 쿼리 활용 사례
1. 조직 구조 시각화: 기업의 조직 구조를 계층적으로 표시하여 각 부서와 직원의 관계를 시각화 할 수 있다.
2. 제품 카테고리 구조: 제품이 상위 카테고리와 하위 서브카테고리로 구성된 경우, 카테고리 구조를 계층조회 할 수 있다.
3. 파일 시스템 탐색: 파일 시스템에서 디렉터리와 파일의 계층 구조를 탐색하는 데 사용될 수 있다.






