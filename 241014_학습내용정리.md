### 관점 지향 프로그래밍 (AOP) 개념 및 사용법 정리

#### 1. 관점 지향 프로그래밍(AOP)이란?

관점 지향 프로그래밍(AOP, Aspect-Oriented Programming)은 공통된 기능을 여러 곳에 중복해서 작성하지 않고, 특정 시점(Point)에서 코드가 실행될 때 이를 자동으로 실행해주는 방식이다. 예를 들어, 로깅, 보안, 트랜잭션 관리 같은 기능을 여러 클래스에서 동일하게 적용할 때 AOP를 사용하면 코드의 중복을 줄이고 유지보수를 용이하게 만들 수 있다.

#### 2. AOP의 기본 동작 원리

AOP에서 핵심적으로 사용하는 개념은 **위빙(Weaving)**이다. 위빙은 클래스 파일에 별도의 공통 로직을 주입하는 과정을 의미한다. 
자바에서 자바 파일을 컴파일하면 `.class` 파일이 생성되는데, 위빙은 이 `.class` 파일에 코드가 실행되는 시점(Point)에 따라 추가적인 로직을 삽입하는 것이다. 이 과정을 통해 AOP를 구현하며, 이를 위해서는 스프링 프레임워크에서 제공하는 **AspectJ** 라이브러리를 사용해야 한다.

스프링에서 위빙은 자동으로 처리된다. 개발자는 단순히 AOP를 적용하고자 하는 부분에 어노테이션을 붙여주기만 하면 된다. 위빙된 클래스는 실제로 실행될 때 추가된 로직과 함께 동작하게 된다. AOP를 사용하기 위해서는 `aspectjweaver.jar` 파일을 의존성으로 추가해야 한다.

#### 3. AOP 핵심 어노테이션 및 개념

AOP는 몇 가지 핵심 어노테이션을 통해 동작한다.

- `@Aspect`: 해당 클래스가 AOP에서 관점을 정의하는 클래스임을 명시한다.
- `@Pointcut`: 특정 메소드가 실행되는 시점을 정의한다. 즉, AOP가 적용될 포인트를 설정하는 역할을 한다.
- `@Before`, `@After`, `@Around`: 특정 시점에 공통 코드를 실행하도록 하는 어노테이션이다. 예를 들어, `@Before`는 메소드 실행 전에, `@After`는 메소드 실행 후에 코드를 실행시킨다.

```java
@Aspect
public class LoggingAspect {

    @Pointcut("execution(public * com.example.demo..service.*ServiceImpl.*(..))")
    public void serviceMethods() {}

    @Before("serviceMethods()")
    public void logBefore(JoinPoint joinPoint) {
        System.out.println("Executing method: " + joinPoint.getSignature().getName());
    }
}
```

위의 예시에서 `@Pointcut`에 정의된 `"execution(public * com.example.demo..service.*ServiceImpl.*(..))"` 부분은 `com.example.demo` 패키지 내의 모든 `ServiceImpl` 클래스의 메소드 실행 시 AOP가 동작하도록 설정하는 것이다. 여기서 `..`은 파라미터와 상관없이 모든 메소드를 대상으로 한다는 의미다.

#### 4. AOP와 트랜잭션 관리

AOP는 트랜잭션 관리에도 자주 사용된다. 스프링에서는 `@Transactional` 어노테이션을 통해 트랜잭션을 관리할 수 있는데, 이 트랜잭션 또한 AOP 원리를 바탕으로 동작한다. 서비스 계층에서 트랜잭션을 걸어주고, 해당 서비스가 실행될 때 트랜잭션이 시작되고 종료되는 과정을 AOP로 처리한다.

트랜잭션은 주로 **서비스 레이어**에서 관리된다. 따라서 **컨트롤러에서는 하나의 서비스만 호출하는 것이 좋다**. 이는 각 서비스가 하나의 트랜잭션 단위로 동작하기 때문이다.

```java
@Service
public class SampleService {

    @Transactional
    public void processBusinessLogic() {
        // 비즈니스 로직 처리
    }
}
```

`@Transactional`이 붙은 메소드는 트랜잭션 내에서 처리되며, 문제가 발생하면 자동으로 롤백된다. 이와 같은 트랜잭션 관리는 주로 데이터베이스와의 연동을 할 때 사용된다.

#### 5. AOP와 Interceptor 비교

AOP와 인터셉터는 모두 특정 시점에서 공통 코드를 실행한다는 점에서 비슷한 역할을 한다. 그러나 두 가지의 사용 목적과 적용 범위는 다르다.

- **AOP**: 메소드 실행 전후, 혹은 중간에 공통된 작업(트랜잭션, 로깅, 보안)을 추가하는 데 사용된다. 주로 서비스 계층에서 비즈니스 로직에 적용한다.
- **Interceptor**: 주로 웹 애플리케이션에서 HTTP 요청과 응답을 가로채는 데 사용된다. 컨트롤러로 들어오는 요청을 가로채 처리하거나, 응답이 나가는 시점을 제어할 때 유용하다.

따라서, 간단한 HTTP 요청 처리나 인증/인가와 같은 작업은 인터셉터로 충분히 처리할 수 있다. 하지만 더 세부적이고, 메소드 레벨에서 동작하는 공통 로직이 필요할 때는 AOP를 사용하는 것이 적절하다.
