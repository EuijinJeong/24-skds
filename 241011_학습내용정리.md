
### 1. **쿼리 차원에서 방어**
- 교재처럼 코드를 작성해도 되지만, **쿼리** 차원에서 보안을 강화하는 것이 더 중요하다. 
- SQL 인젝션, 성능 문제 등을 방어하려면 쿼리에서 적절한 처리와 검증이 필요하다.

### 2. **엑셀 파일 다운로드**
- **Apache POI** 라이브러리를 사용해 엑셀 파일 다운로드를 구현할 수 있다.
- **POI 라이브러리 버전**에 주의해야 한다. 버전에 따라 호환성 문제가 있을 수 있기 때문에 신중하게 선택해야 한다.

### 3. **디버그 레벨에서의 로그 처리**
- **디버그 레벨**에서 파라미터나 쿼리 등 내부적인 상태를 검토할 때 사용한다.
- **인포 레벨**에서는 주로 컨트롤러가 호출되었다는 등의 기본적인 정보만 출력한다.
- 디버그 레벨 로그는 개발 단계에서 파라미터와 반환값을 추적하는 데 유용하다.

### 4. **사용자 화면에 Exception 노출 문제**
- 예외(Exception)를 사용자에게 그대로 노출하면 다음과 같은 보안 및 신뢰도 문제가 발생할 수 있다:
  1. 애플리케이션의 신뢰도 하락.
  2. 시스템 구조 노출로 보안 취약점 증가:
     - 서버 종류, 사용 언어, 패키지 구조, SQL 에러 등 노출 가능하다.

### 5. **Spring에서의 전역적인 예외 처리**
- **Spring**은 애플리케이션에서 발생하는 예외를 전역적으로 처리할 수 있는 기능을 제공한다.
- **`@ControllerAdvice`** 어노테이션을 사용하면, 애플리케이션 전반에서 발생하는 예외를 **Global Exception Handler**에서 일괄 처리할 수 있다.
- 이를 통해 사용자에게 **에러 전용 화면**을 노출하여 보안과 사용자 경험을 개선할 수 있다.

#### GlobalExceptionHandler 예시
```java
@ControllerAdvice
public class GlobalExceptionHandler {
    @ExceptionHandler(Exception.class)
    public String handleAllExceptions(Exception ex, Model model) {
        model.addAttribute("error", ex.getMessage());
        return "errorPage"; // 에러 전용 화면으로 리다이렉트
    }
}
```
이 클래스는 모든 예외를 잡아서 처리하고, 에러 페이지로 사용자에게 안내하는 역할을 한다.

---

### 6. **전역 예외 처리에 대한 구체적인 설명**

전역 예외 처리는 Spring에서 애플리케이션 전체에서 발생하는 예외를 일괄적으로 처리할 수 있다. **`@ControllerAdvice`와 `@ExceptionHandler`**를 활용하면, 시스템의 구조를 노출하지 않고도 발생하는 예외를 한 곳에서 중앙 관리할 수 있다. 특히 보안 강화 측면에서 전역 예외 처리는 필수적이다.

#### 6.1 **전역 예외 처리의 주요 장점**
- **보안 강화**: SQL 에러나 NullPointerException 등의 예외 발생 시, 예외의 구체적인 내용을 사용자에게 노출하지 않고 안전하게 처리할 수 있다.
- **일관된 처리**: 모든 컨트롤러에서 일관된 예외 처리와 에러 페이지 제공이 가능하다.
- **유지보수 용이**: 예외 처리를 한 곳에서 관리하므로, 정책 변경 시 코드 유지보수가 용이하다.

#### 6.2 **구성 예시**

```java
@ControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(Exception.class)
    public ResponseEntity<String> handleAllExceptions(Exception ex) {
        log.error("Error occurred: ", ex);
        return new ResponseEntity<>("서버에서 오류가 발생했습니다. 관리자에게 문의해주세요.", HttpStatus.INTERNAL_SERVER_ERROR);
    }

    @ExceptionHandler(NullPointerException.class)
    public ResponseEntity<String> handleNullPointerException(NullPointerException ex) {
        log.warn("NullPointerException occurred: ", ex);
        return new ResponseEntity<>("데이터 처리 중 문제가 발생했습니다.", HttpStatus.BAD_REQUEST);
    }

    @ExceptionHandler(SQLException.class)
    public ResponseEntity<String> handleSQLException(SQLException ex) {
        log.error("SQL Error: ", ex);
        return new ResponseEntity<>("데이터베이스 처리 중 오류가 발생했습니다.", HttpStatus.INTERNAL_SERVER_ERROR);
    }
}
```

#### 6.3 **에러 페이지 처리**

전역 예외 처리와 함께, 사용자가 예외 발생 시 일관된 **에러 전용 페이지**를 제공받도록 할 수 있다. 예외 발생 시 500 오류나 404 페이지를 사용자에게 안내하여, 시스템의 구체적인 정보를 노출하지 않도록 한다.

```java
@ControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(Exception.class)
    public String handleAllExceptions(Exception ex, Model model) {
        model.addAttribute("errorMessage", "서버에서 문제가 발생했습니다.");
        return "error"; // templates/error.html 페이지로 리다이렉트
    }
}
```

---

### 7. **로그 처리에 대한 구체적인 설명**

로그는 시스템의 상태를 추적하고, 문제 발생 시 원인을 파악하는 데 중요한 역할을 한다. Spring에서는 **SLF4J**와 **Logback** 같은 라이브러리를 통해 다양한 로그 레벨을 사용하여 로그를 기록할 수 있다.

#### 7.1 **로그 레벨 사용 전략**
- **DEBUG**: 개발 단계에서 내부 상태를 추적하기 위해 사용한다. 파라미터 값, 반환값 등을 기록하여 문제 해결을 도와준다.
- **INFO**: 주로 운영 단계에서 중요한 서비스 호출 등을 기록한다.
- **WARN**: 경고성 로그로, 문제가 될 가능성이 있는 상황을 기록한다.
- **ERROR**: 시스템에 치명적인 문제가 발생했을 때 기록하며, 빠른 문제 해결을 위한 정보를 제공한다.

#### 7.2 **로그 사용 예시**

```java
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class SampleController {

    private static final Logger log = LoggerFactory.getLogger(SampleController.class);

    @GetMapping("/api/sample")
    public String sampleEndpoint() {
        log.info("Sample endpoint was called");
        try {
            return "Sample response";
        } catch (Exception ex) {
            log.error("Error occurred while processing sampleEndpoint", ex);
            throw ex;
        }
    }
}
```

#### 7.3 **로그 출력 및 파일 저장 설정**

Spring Boot에서 로그를 파일에 저장하고 적절한 로그 레벨을 설정하려면, `application.yml`에서 다음과 같이 설정할 수 있다:

```yaml
logging:
  file:
    name: application.log
  level:
    root: INFO
    org.springframework.web: DEBUG
```

이 설정은 `application.log`라는 파일에 로그를 저장하고, INFO 이상의 로그가 기록되며, 웹 계층은 DEBUG 레벨로 더 자세히 기록한다.
